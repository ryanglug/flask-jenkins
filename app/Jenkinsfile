pipeline {
  agent any

  environment {
      IMAGE_NAME = 'ryanglug/jenkins-flask'
      IMAGE_TAG = 'latest'
  }

  stages {
    stage('Test') {
      agent {
        label 'python-agent'
      }
      steps {
        sh 'python3 -m venv venv'
        sh '. venv/bin/activate && cd app && pip install -r requirements.txt && pytest'
      }
    }
    // stage('Build') {
    //   steps {
    //      docker.withRegistry('https://index.docker.io/v1/', 'dockerhub') {
    //       def image = docker.build("${IMAGE_NAME}:${IMAGE_TAG}")
    //       image.push()
    //       }
    //   }
    // }
  }
}